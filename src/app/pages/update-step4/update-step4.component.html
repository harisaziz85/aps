<div style="width: 100%; min-height:100vh; padding: 24px; padding-bottom:100px; background:#EEF0F1">
  <app-topbar heading="Projects and Buildings"></app-topbar>
  <app-navbar />
  <div *ngIf="errorMessage" class="error-message">
    <p style="color: red;">{{ errorMessage }}</p>
  </div>
  <div *ngIf="successMessage" class="success-message">
    <p style="color: green;">{{ successMessage }}</p>
  </div>
  <div class="card-container">
    <div class="card ">
      <div class="d-flex itms mb-3">
        <h3 style="width: 325%;">2D Plans ({{ documentCounts['2D Plan'] || 0 }})</h3>
        <div class="custom-dropdown ms-auto">
          <button class="dropdown-btn " style="background-color: black; color:white; height:48px; border-radius:15px; padding-left:20px; padding-right:20px" (click)="toggleDropdown('2D Plan')">
            <span class="me-2">+</span> Add
          </button>
          <div class="dropdown-content" *ngIf="showDropdown['2D Plan']">
            <a (click)="selectMode('2D Plan', 'Single File')">Single File</a>
            <a (click)="selectMode('2D Plan', 'Multiple Files')">Multiple Files</a>
          </div>
        </div>
      </div>
      <div *ngFor="let doc of documents['2D Plan'] || []; let i = index" class="d-flex justify-content-between align-items-center mb-2" style="border:1px solid #CDCCCB; border-radius:15px;padding:16px">
        <span>{{ doc.documentName }} ({{ doc.fileType }})</span>
        <span>
          <span class="text-left me-3">{{ getHierarchyName(doc.hierarchyLevel) }}</span>
          <button (click)="deleteDocument('2D Plan', i)" class="btn">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.75 4.75H15.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.75 4.75V3.25C6.75 2.698 7.198 2.25 7.75 2.25H10.25C10.802 2.25 11.25 2.698 11.25 3.25V4.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13.75 7.25V14.75C13.75 15.855 12.855 16.75 11.75 16.75H6.25C5.145 16.75 4.25 15.855 4.25 14.75V7.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7.25 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10.75 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </span>
      </div>
    </div>
    <div class="card">
      <div class="heading-dropdown-container">
        <h3 style="width: 325%;">Technical Documents ({{ documentCounts['Technical Document'] || 0 }})</h3>
        <div class="custom-dropdown">
          <button class="dropdown-btn" style="background-color: black; color:white; height:48px; border-radius:15px; padding-left:20px; padding-right:20px" (click)="toggleDropdown('Technical Document')">
            <span class="me-2">+</span> Add
          </button>
          <div class="dropdown-content" *ngIf="showDropdown['Technical Document']">
            <a (click)="selectMode('Technical Document', 'Single File')">Single File</a>
            <a (click)="selectMode('Technical Document', 'Multiple Files')">Multiple Files</a>
          </div>
        </div>
      </div>
      <div *ngFor="let doc of documents['Technical Document'] || []; let i = index" class="d-flex justify-content-between align-items-center mb-2" style="border:1px solid #CDCCCB; border-radius:15px;padding:16px">
        <span>{{ doc.documentName }} ({{ doc.fileType }})</span>
        <span>
          <span class="text-left me-3">{{ getHierarchyName(doc.hierarchyLevel) }}</span>
          <button (click)="deleteDocument('Technical Document', i)" class="btn">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.75 4.75H15.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.75 4.75V3.25C6.75 2.698 7.198 2.25 7.75 2.25H10.25C10.802 2.25 11.25 2.698 11.25 3.25V4.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13.75 7.25V14.75C13.75 15.855 12.855 16.75 11.75 16.75H6.25C5.145 16.75 4.25 15.855 4.25 14.75V7.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7.25 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10.75 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </span>
      </div>
    </div>
    <div class="card">
      <div class="itms">
        <h3 style="width: 325%;">Additional Documents ({{ documentCounts['Additional Document'] || 0 }})</h3>
        <div class="custom-dropdown">
          <button class="dropdown-btn" style="background-color: black; color:white;padding-left:20px; padding-right:20px; height:48px; border-radius:15px" (click)="toggleDropdown('Additional Document')">
            <span class="me-2">+</span> Add
          </button>
          <div class="dropdown-content" *ngIf="showDropdown['Additional Document']">
            <a (click)="selectMode('Additional Document', 'Single File')">Single File</a>
            <a (click)="selectMode('Additional Document', 'Multiple Files')">Multiple Files</a>
          </div>
        </div>
      </div>
      <div *ngFor="let doc of documents['Additional Document'] || []; let i = index" class="d-flex justify-content-between align-items-center mb-2" style="border:1px solid #CDCCCB; border-radius:15px;padding:16px">
        <span>{{ doc.documentName }} ({{ doc.fileType }})</span>
        <span>
          <span class="text-left me-3">{{ getHierarchyName(doc.hierarchyLevel) }}</span>
          <button (click)="deleteDocument('Additional Document', i)" class="btn">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.75 4.75H15.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6.75 4.75V3.25C6.75 2.698 7.198 2.25 7.75 2.25H10.25C10.802 2.25 11.25 2.698 11.25 3.25V4.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13.75 7.25V14.75C13.75 15.855 12.855 16.75 11.75 16.75H6.25C5.145 16.75 4.25 15.855 4.25 14.75V7.25" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7.25 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10.75 9.25V13.75" stroke="#EC1919" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </span>
      </div>
    </div>
  </div>
  <div class="modal" style="display: block; position: fixed; z-index: 100000; left: 0; top: 0; width: 100%; height: 100vh; overflow: auto; background-color: rgba(0,0,0,0.4);" *ngIf="isModalOpen">
    <div class="modal-content" style="background-color: #fefefe; margin-left: 60%; margin-top: 0; padding: 20px; border: 1px solid #888; width: 40%; height: 100vh; border-radius: 4px; box-shadow: 0 4px 8px rgba(255, 255, 255, 0.2); position: relative; overflow-y: auto; display: flex; flex-direction: column;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px;">
        <h2 style="margin: 0; font-size: 24px;">{{ documentType || 'Document Upload' }}</h2>
        <span class="close" style="color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer;" (click)="closeModal()">×</span>
      </div>
      <div class="modal-body" style="padding: 20px; flex: 1;">
        <div class="form-group">
          <label for="fileInput" style="display: block; width: 100%; height: 120px; background-color: #ffffff; border: 2px dashed #CDCCCB; height:157px; border-radius: 8px; text-align: center; padding: 40px 20px; color: #888888; font-size: 16px; cursor: pointer;">
            <span style="display: block; margin-bottom: 10px;">
              <svg width="48" height="49" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.332 18.5H20.6654" stroke="#0F0F0F" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.332 26.5H32.6654" stroke="#0F0F0F" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.332 34.5H32.6654" stroke="#0F0F0F" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7.33203 38.5V10.5C7.33203 7.55329 9.7187 5.16663 12.6654 5.16663H27.5614C28.268 5.16663 28.948 5.44663 29.4467 5.94796L39.884 16.3853C40.3854 16.8866 40.6654 17.564 40.6654 18.2706V38.5C40.6654 41.4466 38.2787 43.8333 35.332 43.8333H12.6654C9.7187 43.8333 7.33203 41.4466 7.33203 38.5Z" stroke="#0F0F0F" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M40.4241 17.1666H31.3307C29.8587 17.1666 28.6641 15.9719 28.6641 14.4999V5.4386" stroke="#0F0F0F" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            Drag and Drop or Browse
          </label>
          <input
            id="fileInput"
            type="file"
            [multiple]="isBulkMode()"
            (change)="onFileSelected($event)"
            accept=".pdf,.jpg,.jpeg,.png"
            style="display: none;"
          />
        </div>
        <div class="form-group">
          <label for="hierarchyLevel">Hierarchy Level:</label>
          <div class="custom-dropdown">
            <div class="selected-option" (click)="toggleHierarchyDropdown()">
              {{ getHierarchyName(selectedHierarchyLevel) || 'Select a hierarchy level' }}
              <span class="arrow" [ngClass]="{'open': isHierarchyDropdownOpen}">▾</span>
            </div>
            <ul class="dropdown-options" [ngClass]="{'open': isHierarchyDropdownOpen}">
              <li *ngFor="let level of hierarchyLevels" (click)="selectHierarchyLevel(level._id)">
                {{ level.name }} ({{ level.instanceCount }} instances)
              </li>
            </ul>
          </div>
        </div>
        <div *ngIf="selectedFiles.length > 0">
          <ul style="list-style: none; padding: 0;">
            <li *ngFor="let file of selectedFiles; let i = index">
              <div class="form-group">
                <input
                  [id]="'documentName' + i"
                  type="text"
                  [(ngModel)]="fileMeta[i].documentName"
                  class="form-control"
                  placeholder="Enter document name"
                  required
                />
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div style="padding: 20px 20px 0;">
        <button
          class="btn"
          style="background:black; color:white; width: 100%; height: 48px;"
          (click)="save()"
          [disabled]="!projectId || !documentType || !selectedHierarchyLevel || selectedFiles.length === 0 || isLoadingHierarchy || !isValidMeta()"
        >
          Save
        </button>
      </div>
    </div>
  </div>
  <button class="btn bts1" style="background: black; color:white; height:56px; border-radius:20px" (click)="goToStep5()" [disabled]="!projectId">
    Save and Next <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.75 8.75H15C15.1379 8.75 15.25 8.86214 15.25 9C15.25 9.13786 15.1379 9.25 15 9.25H2.75C2.61214 9.25 2.5 9.13786 2.5 9C2.5 8.86214 2.61214 8.75 2.75 8.75Z" fill="white" stroke="white"/>
<path d="M10.9997 14C10.8077 14 10.6158 13.927 10.4698 13.78C10.1768 13.487 10.1768 13.012 10.4698 12.719L14.1897 8.99901L10.4698 5.27901C10.1768 4.98601 10.1768 4.51101 10.4698 4.21801C10.7628 3.92501 11.2377 3.92501 11.5307 4.21801L15.7807 8.46801C16.0738 8.76101 16.0738 9.23601 15.7807 9.52901L11.5307 13.779C11.3847 13.925 11.1928 13.999 11.0008 13.999L10.9997 14Z" fill="white"/>
</svg>

  </button>
</div>
<app-foot />