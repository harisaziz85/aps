<div class="modal-overlay" *ngIf="isOpen">
  <div class="modal-content">
    <div class="modal-header">
      <button class="close-btn" (click)="closeModal()">
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 10C0 4.47715 4.47715 0 10 0H30C35.5228 0 40 4.47715 40 10V30C40 35.5228 35.5228 40 30 40H10C4.47715 40 0 35.5228 0 30V10Z" fill="white"/>
<path d="M25 15L15 25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M15 15L25 25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="image-container" style="position: relative; width: 600px; height: 600px; margin: 0 auto;">
        <!-- Background image (always visible, no CORS issues) -->
        <img #image [src]="imageUrl" alt="Selected Image" class="modal-img" 
             style="width: 600px; height: 600px; object-fit: cover; display: block;"/>
        
        <!-- Transparent canvas overlay for annotations -->
        <canvas #canvas 
                (mousedown)="startDrawing($event)" 
                (mousemove)="draw($event)" 
                (mouseup)="stopDrawing()" 
                (mouseleave)="stopDrawing()"
                style="position: absolute; top: 0; left: 0; width: 600px; height: 600px; background: transparent; cursor: crosshair;">
        </canvas>
      </div>
      <div>
      <div class="edit-controls" style="display: flex; justify-content: center;">
        <button *ngIf="!isEditMode" style="height: 48px; border:0px;width:106px;border-radius:15px;display:flex; justify-content:center" class="edit-btn" (click)="toggleEditMode()">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.82177 12.7497C7.82177 12.7497 10.3228 12.1017 11.4178 10.4947L15.4548 4.57372C15.9838 3.79772 15.7838 2.73872 15.0078 2.20972C14.2318 1.68072 13.1728 1.88072 12.6438 2.65672L8.60676 8.57772C7.51176 10.1847 7.82177 12.7497 7.82177 12.7497Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.25 12.75H4.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.25 16.25H15.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
          Edit
        </button>
        
        <div *ngIf="isEditMode" class="edit-tools-inline">
          <button class="tool-btn" [class.active]="currentTool === 'arrow'" (click)="setTool('arrow')">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 16.5C8.586 16.5 8.25 16.164 8.25 15.75V3.5C8.25 3.086 8.586 2.75 9 2.75C9.414 2.75 9.75 3.086 9.75 3.5V15.75C9.75 16.164 9.414 16.5 9 16.5Z" fill="#0F0F0F"/>
              <path d="M13.2508 8.24975C13.0588 8.24975 12.8668 8.17675 12.7208 8.02975L9.00075 4.30975L5.28075 8.02975C4.98775 8.32275 4.51275 8.32275 4.21975 8.02975C3.92675 7.73675 3.92675 7.26175 4.21975 6.96875L8.47075 2.71975C8.76375 2.42675 9.23875 2.42675 9.53175 2.71975L13.7818 6.96975C14.0748 7.26275 14.0748 7.73775 13.7818 8.03075C13.6358 8.17675 13.4438 8.25075 13.2518 8.25075L13.2508 8.24975Z" fill="#0F0F0F"/>
            </svg>
          </button>
          
          <button class="tool-btn" [class.active]="currentTool === 'line'" (click)="setTool('line')">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14.7198 2.71977L2.21975 15.2198C1.92675 15.5128 1.92675 15.9878 2.21975 16.2808C2.36575 16.4268 2.55775 16.5008 2.74975 16.5008C2.94175 16.5008 3.13375 16.4278 3.27975 16.2808L15.7797 3.77977C16.0728 3.48677 16.0728 3.01177 15.7797 2.71877C15.4867 2.42577 15.0118 2.42577 14.7188 2.71877L14.7198 2.71977Z" fill="#0F0F0F"/>
            </svg>
          </button>
          
          <button class="tool-btn" [class.active]="currentTool === 'circle'" (click)="setTool('circle')">
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 16.75C13.0041 16.75 16.25 13.5041 16.25 9.5C16.25 5.49594 13.0041 2.25 9 2.25C4.99594 2.25 1.75 5.49594 1.75 9.5C1.75 13.5041 4.99594 16.75 9 16.75Z" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          
          <button class="tool-btn" [class.active]="currentTool === 'text'" (click)="setTool('text')" >
            <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14.25 2.75H3.75C2.645 2.75 1.75 3.646 1.75 4.75V11.75C1.75 12.854 2.645 13.75 3.75 13.75H5.75V16.75L9.5 13.75H14.25C15.355 13.75 16.25 12.854 16.25 11.75V4.75C16.25 3.646 15.355 2.75 14.25 2.75Z" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button style="border: 0px !important; background:rgba(255, 0, 0, 0)">
          <input type="color" [(ngModel)]="color" (change)="updateColor()" class="color-picker"/>
           
          </button>
          
          <button class="tool-btn" (click)="undo()">
           <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.75 4.25H15.25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M6.75 4.25V2.75C6.75 2.198 7.198 1.75 7.75 1.75H10.25C10.802 1.75 11.25 2.198 11.25 2.75V4.25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M13.75 6.75V14.25C13.75 15.355 12.855 16.25 11.75 16.25H6.25C5.145 16.25 4.25 15.355 4.25 14.25V6.75" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M7.25 8.75V13.25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10.75 8.75V13.25" stroke="#0F0F0F" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
          </button>
          
         
        </div>
         <button class="tool-btn save-btn" (click)="saveImage()" style="border-radius: 15px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.75 9.25L6.75 14.25L15.25 3.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
         </button>
      </div>
    </div>
  </div>
</div>